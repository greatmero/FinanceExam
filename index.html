<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Interactive Finance Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Base & Theme --- */
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #0d1117;
            background-image: radial-gradient(circle at 1px 1px, #21262d 1px, transparent 0);
            background-size: 2rem 2rem;
        }
        .main-container {
            background: #161b22;
            border: 1px solid #30363d;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 15px rgba(139, 92, 246, 0.1);
        }
        .text-gradient {
            background: linear-gradient(to right, #a5b4fc, #d8b4fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- Buttons --- */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        .btn-primary {
            background: #6d28d9;
            border-color: #8b5cf6;
            box-shadow: inset 0 1px 0 0 rgba(255,255,255,0.1);
        }
        .btn-primary:hover {
            background: #7c3aed;
            box-shadow: inset 0 1px 0 0 rgba(255,255,255,0.1), 0 0 20px rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #30363d;
            border-color: #4b5563;
        }
        .btn-secondary:hover {
            background: #4b5563;
            border-color: #6b7280;
            transform: translateY(-2px);
        }
        .btn-amber {
            background: #d97706;
            border-color: #fbbf24;
        }
        .btn-amber:hover {
            background: #ea580c;
            box-shadow: inset 0 1px 0 0 rgba(255,255,255,0.1), 0 0 20px rgba(251, 191, 36, 0.4);
            transform: translateY(-2px);
        }

        /* --- Selection Cards --- */
        .selection-card {
            background: #21262d;
            border: 1px solid #30363d;
            transition: all 0.3s ease;
        }
        .selection-card:hover {
            transform: translateY(-5px);
            border-color: #8b5cf6;
            box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.1);
        }
        .card-icon {
            background: linear-gradient(145deg, #4338ca, #6d28d9);
        }

        /* --- Quiz Elements --- */
        .option-btn {
            background: #21262d;
            border: 1px solid #4b5563;
            transition: all 0.2s ease-in-out;
        }
        .option-btn:hover {
            border-color: #a5b4fc;
            background: rgba(165, 180, 252, 0.1);
        }
        .option-btn.correct { background: rgba(52, 211, 153, 0.1); border-color: #34d399; }
        .option-btn.incorrect { background: rgba(248, 113, 113, 0.1); border-color: #f87171; }
        .option-btn.skipped { background: rgba(96, 165, 250, 0.1); border-color: #60a5fa; }
        
        .progress-bar-inner { background: linear-gradient(to right, #818cf8, #c084fc); }
        
        /* --- Results Chart --- */
        .score-chart { position: relative; width: 150px; height: 150px; }
        .score-chart-circle {
            transition: stroke-dashoffset 1s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* --- Animations --- */
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stagger-in > * {
            animation: fadeIn 0.5s ease-in-out backwards;
        }
    </style>
</head>
<body class="text-gray-300 flex items-center justify-center min-h-screen p-4">

    <div id="quiz-container" class="w-full max-w-2xl main-container shadow-2xl rounded-2xl p-6 md:p-8">
        
        <div id="loading-screen" class="text-center p-8">
            <h1 class="text-3xl font-bold text-gradient mb-4">Finance Quiz</h1>
            <p class="text-gray-400">Loading...</p>
        </div>

        <div id="chapter-selection-screen" class="hidden">
            <h1 class="text-3xl md:text-4xl font-extrabold text-center text-gradient mb-2">Finance Quiz</h1>
            <p class="text-gray-400 text-center mb-8">Choose a chapter to start your learning journey.</p>
            <div id="chapter-buttons-container" class="space-y-4 stagger-in"></div>
        </div>

        <div id="sector-selection-screen" class="hidden">
            <button id="back-to-chapters-btn-from-sector" class="mb-6 text-sm text-violet-400 hover:underline flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                Back to Chapters
            </button>
            <h2 id="sector-selection-title" class="text-2xl md:text-3xl font-bold text-center text-gradient mb-8">Select a Sector</h2>
            <div id="sector-buttons-container" class="space-y-4 stagger-in"></div>
        </div>

        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="back-to-sectors-btn" class="text-sm text-violet-400 hover:underline flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    Back to Sectors
                </button>
                <div class="flex items-center space-x-2">
                    <label for="question-nav-select" class="text-sm font-medium">Go to:</label>
                    <select id="question-nav-select" class="bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-violet-500 focus:border-violet-500 block p-1.5"></select>
                </div>
            </div>
            
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                     <p class="text-sm font-semibold text-violet-400">Question <span id="question-number"></span> / <span id="total-questions"></span></p>
                     <p class="text-sm font-semibold text-gray-300">Score: <span id="score">0</span></p>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div id="progress-bar" class="progress-bar-inner h-2 rounded-full transition-all duration-300"></div>
                </div>
            </div>
            
            <div class="bg-gray-800/50 p-6 rounded-lg mt-6">
                <p id="topic-title" class="text-xs uppercase tracking-widest text-violet-400 mb-2 font-semibold"></p>
                <h3 id="question-text" class="text-xl md:text-2xl font-semibold text-gray-100 mb-6 min-h-[6rem]"></h3>
                <div id="options-container" class="space-y-3"></div>
            </div>
            
            <div id="feedback-container" class="mt-6 p-4 rounded-lg hidden"></div>

            <div class="mt-8 flex justify-between space-x-4">
                <button id="prev-btn" class="w-1/2 btn btn-secondary font-bold py-3 px-6 rounded-lg text-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    <span>Previous</span>
                </button>
                <button id="next-btn" class="w-1/2 btn btn-primary font-bold py-3 px-6 rounded-lg text-lg">
                    <span>Next</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>
        </div>

        <div id="result-screen" class="hidden text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-gradient mb-4">Quiz Complete!</h2>
            
            <div class="my-8 flex justify-center">
                <div class="score-chart">
                    <svg class="w-full h-full" viewBox="0 0 100 100">
                        <circle class="text-gray-700" stroke-width="10" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                        <circle id="score-circle" class="text-violet-500 score-chart-circle" stroke-width="10" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                    </svg>
                    <div id="final-score" class="absolute inset-0 flex items-center justify-center text-3xl font-extrabold text-white"></div>
                </div>
            </div>

            <p id="result-message" class="text-gray-400 mb-8 text-lg"></p>
            
            <div id="wrong-answers-container" class="hidden mt-8 text-left">
                <h3 class="text-xl font-bold mb-4 text-gray-200">Questions to Review:</h3>
                <div id="wrong-answers-list" class="max-h-48 overflow-y-auto custom-scrollbar bg-gray-800/50 p-4 rounded-lg space-y-2"></div>
                <button id="review-wrong-btn" class="w-full mt-4 btn btn-amber font-bold py-3 px-6 rounded-lg text-lg">
                    Review Incorrect Questions
                </button>
            </div>

            <div class="mt-8 flex flex-col space-y-4">
                <button id="restart-btn" class="w-full btn btn-primary font-bold py-3 px-6 rounded-lg text-lg">Try Same Sector Again</button>
                <button id="back-to-main-menu-btn" class="w-full btn btn-secondary font-bold py-3 px-6 rounded-lg text-lg">Choose Another Chapter</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const chaptersConfig = {
            'chapter1': { 
                title: 'Finance Chapter 1', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>',
                file: 'chapter2.json' 
            },
            'chapter2': { 
                title: 'Chapter 2', 
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>',
                file: 'chapter2.json'
            },
            'chapter11': {
                title: 'Capital Budgeting',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>',
                file: 'chapter11.json'
            }
            'chapter6': {
                title: 'Risk & Return',
                icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>',
                file: 'chapter6.json'
            
            // Add more chapters here following the same format
        };

        // --- GLOBAL & DOM VARIABLES ---
        let allQuizzes = {}, currentQuestionIndex = 0, score = 0, activeQuizData = [], incorrectlyAnswered = [], answeredQuestions = new Set(), currentChapterKey = '', currentSectorKey = '';
        const dom = {};
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const elementIds = ['loading-screen', 'chapter-selection-screen', 'sector-selection-screen', 'quiz-screen', 'result-screen', 'chapter-buttons-container', 'sector-buttons-container', 'sector-selection-title', 'back-to-chapters-btn-from-sector', 'back-to-sectors-btn', 'question-nav-select', 'topic-title', 'question-number', 'total-questions', 'score', 'progress-bar', 'question-text', 'options-container', 'feedback-container', 'prev-btn', 'next-btn', 'final-score', 'result-message', 'wrong-answers-container', 'wrong-answers-list', 'review-wrong-btn', 'restart-btn', 'back-to-main-menu-btn', 'score-circle'];
            elementIds.forEach(id => {
                dom[id] = document.getElementById(id);
            });
            initializeApp();
        });
        
        function initializeApp() {
            populateChapters();
            addEventListeners();
            showScreen('chapter-selection-screen');
        }

        function addEventListeners() {
            dom['prev-btn'].addEventListener('click', previousQuestion);
            dom['next-btn'].addEventListener('click', nextQuestion);
            dom['restart-btn'].addEventListener('click', () => startQuiz(currentChapterKey, currentSectorKey));
            dom['review-wrong-btn'].addEventListener('click', reviewIncorrectQuestions);
            dom['back-to-chapters-btn-from-sector'].addEventListener('click', () => showScreen('chapter-selection-screen'));
            dom['back-to-sectors-btn'].addEventListener('click', () => showSectorSelection(currentChapterKey));
            dom['back-to-main-menu-btn'].addEventListener('click', () => showScreen('chapter-selection-screen'));
            dom['question-nav-select'].addEventListener('change', navigateToQuestion);
        }

        function populateChapters() {
            dom['chapter-buttons-container'].innerHTML = '';
            Object.keys(chaptersConfig).forEach((key, index) => {
                const chapterInfo = chaptersConfig[key];
                const button = createMenuButton(`Ch. ${index + 1}`, chapterInfo.title, chapterInfo.icon, () => loadChapter(key));
                button.style.animationDelay = `${index * 100}ms`;
                dom['chapter-buttons-container'].appendChild(button);
            });
        }
        
        async function loadChapter(chapterKey) {
            // If chapter data is already loaded, just show the sectors
            if (allQuizzes[chapterKey]) {
                showSectorSelection(chapterKey);
                return;
            }

            const fileName = chaptersConfig[chapterKey].file;
            showScreen('loading-screen'); // Show loading screen while fetching

            try {
                const response = await fetch(`./${fileName}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const chapterData = await response.json();
                allQuizzes[chapterKey] = chapterData; // Store the fetched data
                showSectorSelection(chapterKey);
            } catch (error) {
                console.error("Failed to load chapter data:", error);
                dom['loading-screen'].innerHTML = `<div class="bg-red-900/50 border border-red-500 p-4 rounded-lg"><h1 class="text-xl font-bold text-red-300 mb-2">Error Loading Chapter</h1><p class="text-red-300/80">Could not fetch '${fileName}'. Please make sure the file exists and is accessible. Error: ${error.message}</p></div>`;
            }
        }

        function populateSectors(chapterKey) {
            dom['sector-buttons-container'].innerHTML = '';
            const chapter = allQuizzes[chapterKey];
            dom['sector-selection-title'].innerText = `Sectors in: ${chapter.title}`;
            Object.keys(chapter.sectors).forEach((sectorKey, index) => {
                const sectorInfo = chapter.sectors[sectorKey];
                const button = createMenuButton(`Sec. ${index + 1}`, sectorInfo.title, `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>`, () => startQuiz(chapterKey, sectorKey));
                button.style.animationDelay = `${index * 100}ms`;
                dom['sector-buttons-container'].appendChild(button);
            });
        }

        function createMenuButton(number, title, icon, onClickHandler) {
            const button = document.createElement('button');
            button.className = 'w-full text-left selection-card p-4 rounded-lg flex items-center space-x-4';
            button.innerHTML = `
                <div class="flex-shrink-0 h-16 w-16 flex items-center justify-center card-icon text-violet-200 rounded-lg">${icon || ''}</div>
                <div>
                    <p class="text-xs text-violet-400 font-semibold">${number}</p>
                    <p class="font-bold text-gray-100 text-lg">${title}</p>
                </div>
            `;
            button.onclick = onClickHandler;
            return button;
        }

        function showScreen(screenId) {
            Object.keys(dom).forEach(key => {
                if (key.endsWith('-screen')) {
                    dom[key].classList.add('hidden');
                }
            });
            dom[screenId].classList.remove('hidden');
            dom[screenId].classList.add('fade-in');
        }

        function showSectorSelection(chapterKey) {
            currentChapterKey = chapterKey;
            populateSectors(chapterKey);
            showScreen('sector-selection-screen');
        }

        function startQuiz(chapterKey, sectorKey, questions = null) {
            currentChapterKey = chapterKey;
            currentSectorKey = sectorKey;
            activeQuizData = questions || allQuizzes[chapterKey].sectors[sectorKey].questions;
            currentQuestionIndex = 0; score = 0; incorrectlyAnswered = []; answeredQuestions.clear();
            showScreen('quiz-screen');
            loadQuestion();
        }

        function reviewIncorrectQuestions() {
            if (incorrectlyAnswered.length === 0) return;
            startQuiz(currentChapterKey, currentSectorKey, [...incorrectlyAnswered]);
        }

        function loadQuestion() {
            dom['options-container'].innerHTML = '';
            dom['feedback-container'].classList.add('hidden');
            const q = activeQuizData[currentQuestionIndex];
            
            dom['topic-title'].innerText = `${q.topic} - Original Q# ${q.q_num}`;
            dom['question-number'].innerText = currentQuestionIndex + 1;
            dom['total-questions'].innerText = activeQuizData.length;
            dom['score'].innerText = score;
            dom['progress-bar'].style.width = `${((currentQuestionIndex) / activeQuizData.length) * 100}%`;
            dom['question-text'].innerText = q.question;
            dom['question-text'].classList.add('fade-in');
            setTimeout(() => dom['question-text'].classList.remove('fade-in'), 500);

            populateQuestionNav();
            
            (q.type === 'tf' ? ['True', 'False'] : q.options).forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.className = 'w-full text-left p-4 rounded-lg border option-btn';
                button.onclick = () => selectAnswer(option, button);
                dom['options-container'].appendChild(button);
            });

            dom['prev-btn'].disabled = (currentQuestionIndex === 0);
            dom['prev-btn'].style.opacity = dom['prev-btn'].disabled ? '0.5' : '1';
            dom['next-btn'].querySelector('span').textContent = (currentQuestionIndex === activeQuizData.length - 1) ? 'Show Results' : 'Next';
        }

        function selectAnswer(selectedOption, button) {
            if (answeredQuestions.has(currentQuestionIndex)) return;
            const q = activeQuizData[currentQuestionIndex];
            const isCorrect = selectedOption.toString().toLowerCase() === q.answer.toString().toLowerCase();
            answeredQuestions.add(currentQuestionIndex);

            Array.from(dom['options-container'].children).forEach(btn => {
                btn.disabled = true;
                const isCorrectAnswer = btn.innerText.toString().toLowerCase() === q.answer.toString().toLowerCase();
                if (isCorrectAnswer) btn.classList.add('correct');
                else if (btn === button) btn.classList.add('incorrect');
            });

            dom['feedback-container'].classList.remove('hidden');
            dom['feedback-container'].classList.add('fade-in');
            if (isCorrect) {
                score++;
                dom['feedback-container'].innerHTML = `<p class="font-semibold text-green-400">Correct!</p><p class="text-sm mt-1 text-gray-400">${q.explanation}</p>`;
            } else {
                dom['feedback-container'].innerHTML = `<p class="font-semibold text-red-400">Incorrect!</p><p class="text-sm mt-1 text-gray-400">${q.explanation}</p>`;
                if (!incorrectlyAnswered.some(iq => iq.q_num === q.q_num && iq.topic === q.topic)) {
                    incorrectlyAnswered.push(q);
                }
            }
            dom['score'].innerText = score;
        }

        function nextQuestion() {
            if (!answeredQuestions.has(currentQuestionIndex)) {
                showSkippedFeedback();
                setTimeout(goToNext, 1500);
            } else {
                goToNext();
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToNext() {
             if (currentQuestionIndex < activeQuizData.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                displayResults();
            }
        }
        
        function showSkippedFeedback() {
            const q = activeQuizData[currentQuestionIndex];
            Array.from(dom['options-container'].children).forEach(btn => {
                btn.disabled = true;
                if(btn.innerText.toString().toLowerCase() === q.answer.toString().toLowerCase()){
                    btn.classList.add('skipped');
                }
            });
            dom['feedback-container'].innerHTML = `<p class="font-semibold text-blue-400">Skipped</p><p class="text-sm mt-1 text-gray-400">The correct answer is: <strong>${q.answer}</strong>. ${q.explanation}</p>`;
            dom['feedback-container'].classList.remove('hidden');
        }

        function displayResults() {
            showScreen('result-screen');
            const percentage = activeQuizData.length > 0 ? Math.round((score / activeQuizData.length) * 100) : 0;
            dom['final-score'].innerText = `${percentage}%`;
            
            const radius = 45;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            dom['score-circle'].style.strokeDashoffset = offset;

            let message = '';
            if (percentage === 100) message = "Perfect Score! You're an economics expert!";
            else if (percentage >= 80) message = "Excellent job! You have a strong grasp of these topics.";
            else if (percentage >= 60) message = "Good effort! A little more review will make you an expert.";
            else message = "Keep studying! Review the explanations to improve your score.";
            dom['result-message'].innerText = message;
            
            if (incorrectlyAnswered.length > 0) {
                dom['wrong-answers-container'].classList.remove('hidden');
                dom['wrong-answers-list'].innerHTML = '';
                incorrectlyAnswered.forEach(q => {
                    const li = document.createElement('li');
                    li.textContent = `Q: ${q.question}`;
                    li.className = 'text-sm p-2 bg-gray-900/70 rounded';
                    dom['wrong-answers-list'].appendChild(li);
                });
            } else {
                dom['wrong-answers-container'].classList.add('hidden');
            }
        }

        function populateQuestionNav() {
            dom['question-nav-select'].innerHTML = '';
            activeQuizData.forEach((_, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.innerText = `Q ${index + 1}`;
                dom['question-nav-select'].appendChild(option);
            });
            dom['question-nav-select'].value = currentQuestionIndex;
        }

        function navigateToQuestion(event) {
            const newIndex = parseInt(event.target.value, 10);
            if (newIndex !== currentQuestionIndex) {
                currentQuestionIndex = newIndex;
                loadQuestion();
            }
        }
    </script>
</body>
</html>
